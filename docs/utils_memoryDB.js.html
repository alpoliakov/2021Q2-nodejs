<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utils/memoryDB.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utils/memoryDB.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const User = require('../resources/users/user.model');
const Board = require('../resources/boards/board.model');
const Task = require('../resources/tasks/task.model');

/** @module DB */

/**
 * Data Base object.
 * @typedef {Object} DB
 * @property {User[]} Users - Array user objects
 * @property {Board[]} Boards - Array board objects
 * @property {Array.&lt;Task>} Tasks - Array task objects
 * @property {Function} fixStructureUsers Assignment to a field an user.id null to the user's tasks, if we delete the user.
 * @property {Function} fixStructureBoards Removing tasks from the array of tasks when deleting a board.
 * @property {Function} fixStructureTasks Removing tasks.
 */

/** @type {DB} */

const DB = {
  Users: [],
  Boards: [],
  Tasks: [],
  /**
   * @param {Object} user - User entity
   * @returns void
   */
  fixStructureUsers: (user) => {
    if (user) {
      DB.Tasks = [
        ...DB.Tasks.filter((task) => task).map((task) => {
          const item = { ...task };
          item.userId = task.userId === user.id ? null : task.userId;
          return item;
        }),
      ];
    }
  },
  /**
   * @param {Object} board - Board entity
   * @returns void
   */
  fixStructureBoards: (board) => {
    if (board) {
      DB.Tasks = [
        ...DB.Tasks.filter((task) => task &amp;&amp; task.boardId !== board.id),
      ];
    }
  },
  /**
   * @returns {Object}
   */
  fixStructureTasks: () => {},
};

/**
 * Returns an array of all entities with the passed name.
 * @param {string} nameEntity Entity name
 * @returns {Array&lt;Object>} Array of all entities with the passed name
 */
const getAllEntities = (nameEntity) => DB[nameEntity].filter((item) => item);

/**
 * Returns entity from DB with the passed name and id.
 * @param {string} nameEntity Entity name
 * @param {string} id Id entity
 * @returns {Object} Entity object
 */
const getEntity = (nameEntity, id) => {
  const entities = DB[nameEntity]
    .filter((item) => item)
    .filter((item) => item.id === id);

  if (entities.length > 1) {
    console.error(
      `DB data is damaged. Entity: ${nameEntity}. EntityID: ${id}.`
    );
    throw Error('DB data is wrong!');
  }

  return entities[0];
};

/**
 * Returns updated entity from DB with the passed name, id and entity.
 * @param {string} nameEntity - Entity name
 * @param {string} id - Entity id
 * @param {Object} entity - Entity object
 * @returns {Object} - Updated entity
 */
const updateEntity = async (nameEntity, id, entity) => {
  const oldEntity = getEntity(nameEntity, id);

  if (oldEntity) {
    DB[nameEntity][DB[nameEntity].indexOf(oldEntity)] = { id, ...entity };
  }

  return getEntity(nameEntity, id);
};

/**
 * Returns deleted entity from DB with the passed name and id.
 * @param {string} nameEntity Entity name
 * @param {string} id Id entity
 * @returns {Object} Entity object
 */
const removeEntity = (nameEntity, id) => {
  const entity = getEntity(nameEntity, id);

  if (entity) {
    DB[`fixStructure${nameEntity}`](entity);
    DB[nameEntity] = [
      ...DB[nameEntity].filter((item) => item &amp;&amp; item.id !== id),
    ];
  }

  return entity;
};

/**
 * Returns saved entity from DB with the passed name entity and entity.
 * @param {string} nameEntity Entity name
 * @param {Object} entity Entity object
 * @returns {Object} Entity object
 */
const saveEntity = (nameEntity, entity) => {
  DB[nameEntity].push(entity);

  return getEntity(nameEntity, entity.id);
};

(() => {
  for (let i = 0; i &lt; 3; i += 1) {
    DB.Users.push(new User());
  }

  const board = new Board();
  DB.Boards.push(board);
  DB.Tasks.push(
    new Task({ boardId: board.id }),
    new Task({ boardId: board.id })
  );
})();

module.exports = {
  getAllEntities,
  getEntity,
  updateEntity,
  saveEntity,
  removeEntity,
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-DB.html">DB</a></li><li><a href="module-startService.html">startService</a></li><li><a href="module-userRepo.html">userRepo</a></li><li><a href="module-wrapAsyncFunc.html">wrapAsyncFunc</a></li></ul><h3>Classes</h3><ul><li><a href="Board.html">Board</a></li><li><a href="NotFoundError.html">NotFoundError</a></li><li><a href="Task.html">Task</a></li><li><a href="User.html">User</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Tue May 25 2021 01:40:39 GMT+0300 (Eastern European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
