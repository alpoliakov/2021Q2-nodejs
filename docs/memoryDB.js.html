<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: memoryDB.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: memoryDB.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const User = require('../resources/users/user.model');
const Board = require('../resources/boards/board.model');
const Task = require('../resources/tasks/task.model');

/**
 * Data Base object.
 * @type {
 *   {
 *     Users: Array&lt;Object>,
 *     Boards: Array&lt;Object>,
 *     Tasks: Array&lt;Object>,
 *     fixStructureUsers: function,
 *     fixStructureBoards: function,
 *     fixStructureTasks: function
 *
 *   }
 * }
 */

const DB = {
  Users: [],
  Boards: [],
  Tasks: [],
  fixStructureUsers: (user) => {
    if (user) {
      DB.Tasks = [
        ...DB.Tasks.filter((task) => task).map((task) => {
          const item = { ...task };
          item.userId = task.userId === user.id ? null : task.userId;
          return item;
        }),
      ];
    }
  },
  fixStructureBoards: (board) => {
    if (board) {
      DB.Tasks = [
        ...DB.Tasks.filter((task) => task &amp;&amp; task.boardId !== board.id),
      ];
    }
  },
  fixStructureTasks: () => {},
};

/**
 * Returns an array of all entities with the passed name.
 * @param {string} entityName first term
 * @returns {Array&lt;Object>} Array of all entities
 */
const getAllEntities = (entityName) => DB[entityName].filter((item) => item);

const getEntity = (entityName, id) => {
  const entities = DB[entityName]
    .filter((item) => item)
    .filter((item) => item.id === id);

  if (entities.length > 1) {
    console.error(
      `DB data is damaged. Entity: ${entityName}. EntityID: ${id}.`
    );
    throw Error('DB data is wrong!');
  }

  return entities[0];
};

const updateEntity = async (nameEntity, id, entity) => {
  const oldEntity = getEntity(nameEntity, id);

  if (oldEntity) {
    DB[nameEntity][DB[nameEntity].indexOf(oldEntity)] = { id, ...entity };
  }

  return getEntity(nameEntity, id);
};

const removeEntity = (nameEntity, id) => {
  const entity = getEntity(nameEntity, id);

  if (entity) {
    DB[`fixStructure${nameEntity}`](entity);
    DB[nameEntity] = [
      ...DB[nameEntity].filter((item) => item &amp;&amp; item.id !== id),
    ];
  }

  return entity;
};

const saveEntity = (nameEntity, entity) => {
  DB[nameEntity].push(entity);

  return getEntity(nameEntity, entity.id);
};

(() => {
  for (let i = 0; i &lt; 3; i += 1) {
    DB.Users.push(new User());
  }

  const board = new Board();
  DB.Boards.push(board);
  DB.Tasks.push(
    new Task({ boardId: board.id }),
    new Task({ boardId: board.id })
  );
})();

module.exports = {
  getAllEntities,
  getEntity,
  updateEntity,
  saveEntity,
  removeEntity,
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#DB">DB</a></li><li><a href="global.html#getAllEntities">getAllEntities</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Mon May 24 2021 15:18:18 GMT+0300 (Eastern European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
